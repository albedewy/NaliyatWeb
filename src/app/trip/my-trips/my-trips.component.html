<div class="my-trips-container">
  <div class="page-header">
    <div class="header-content">
      <h1><i class="fa fa-road"></i> {{ '::MyTrips:Title' | abpLocalization }}</h1>
      <p>{{ '::MyTrips:Subtitle' | abpLocalization }}</p>
    </div>
  </div>

  @if (errorMessage) {
    <div class="alert alert-danger">
      <i class="fa fa-exclamation-circle"></i>
      {{ errorMessage }}
    </div>
  }

  <div class="filters-section">
    <div class="search-bar">
      <i class="fa fa-search"></i>
      <input
        type="text"
        [placeholder]="'::MyTrips:SearchPlaceholder' | abpLocalization"
        (input)="onSearch($event)"
      />
    </div>

    <div class="status-filters">
      <button 
        class="filter-btn" 
        [class.active]="selectedStatus === 'all'"
        (click)="onStatusFilter('all')">
        {{ '::MyTrips:All' | abpLocalization }}
      </button>
      <button 
        class="filter-btn" 
        [class.active]="selectedStatus === '2'"
        (click)="onStatusFilter('2')">
        {{ '::MyTrips:WaitingAgreement' | abpLocalization }}
      </button>
      <button 
        class="filter-btn" 
        [class.active]="selectedStatus === '3'"
        (click)="onStatusFilter('3')">
        {{ '::MyTrips:WaitingPayment' | abpLocalization }}
      </button>
      <button 
        class="filter-btn" 
        [class.active]="selectedStatus === '4'"
        (click)="onStatusFilter('4')">
        {{ '::MyTrips:OnItsWay' | abpLocalization }}
      </button>
      <button 
        class="filter-btn" 
        [class.active]="selectedStatus === '5'"
        (click)="onStatusFilter('5')">
        {{ '::MyTrips:Arrived' | abpLocalization }}
      </button>
    </div>
  </div>

  @if (isLoading) {
    <div class="loading-state">
      <i class="fa fa-spinner fa-spin"></i>
      <p>{{ '::MyTrips:LoadingYourTrips' | abpLocalization }}</p>
    </div>
  } @else if (filteredTrips.length === 0) {
    <div class="empty-state">
      <i class="fa fa-truck"></i>
      @if (searchTerm || selectedStatus !== 'all') {
        <h3>{{ '::TripList:NoTripsFound' | abpLocalization }}</h3>
        <p>{{ '::MyTrips:NoTripsMatch' | abpLocalization }}</p>
        <button class="btn-clear-filters" (click)="searchTerm = ''; selectedStatus = 'all'; applyFilters()">
          {{ '::MyTrips:ClearFilters' | abpLocalization }}
        </button>
      } @else {
        <h3>{{ '::MyTrips:NoTripsYet' | abpLocalization }}</h3>
        <p>{{ '::MyTrips:NoAssignedTrips' | abpLocalization }}</p>
        <a routerLink="/trip/available" class="btn-primary">
          <i class="fa fa-search"></i> {{ '::MyTrips:BrowseAvailableTrips' | abpLocalization }}
        </a>
      }
    </div>
  } @else {
    <div class="trips-count">
      {{ '::MyTrips:Showing' | abpLocalization }} {{ filteredTrips.length }} {{ filteredTrips.length !== 1 ? ('::MyTrips:Trips' | abpLocalization) : ('::MyTrips:Trip' | abpLocalization) }}
    </div>

    <div class="trips-list">
      @for (trip of filteredTrips; track trip.id) {
        <div class="trip-card">
          <div class="trip-header">
            <div class="route-info">
              <div class="location from">
                <i class="fa fa-map-marker"></i>
                <span>{{ trip.fromLocation || ('::MyTrips:Unknown' | abpLocalization) }}</span>
              </div>
              <div class="route-arrow">
                <i class="fa fa-long-arrow-right"></i>
              </div>
              <div class="location to">
                <i class="fa fa-flag-checkered"></i>
                <span>{{ trip.toLocation || ('::MyTrips:Unknown' | abpLocalization) }}</span>
              </div>
            </div>
            <span class="status-badge" [ngClass]="getStatusClass(trip.statusId)">
              {{ getStatusName(trip.statusId) }}
            </span>
          </div>

          <div class="trip-details">
            <div class="detail-item">
              <i class="fa fa-calendar"></i>
              <div>
                <span class="label">{{ '::Trip:StartDate' | abpLocalization }}</span>
                <span class="value">{{ formatDate(trip.startDate) }}</span>
              </div>
            </div>
            <div class="detail-item">
              <i class="fa fa-calendar-check-o"></i>
              <div>
                <span class="label">{{ '::Trip:EndDate' | abpLocalization }}</span>
                <span class="value">{{ formatDate(trip.endDate) }}</span>
              </div>
            </div>
            <div class="detail-item">
              <i class="fa fa-truck"></i>
              <div>
                <span class="label">{{ '::Trip:TruckType' | abpLocalization }}</span>
                <span class="value">{{ getTruckTypeName(trip.truckTypeId) }}</span>
              </div>
            </div>
            @if (trip.goodsType) {
              <div class="detail-item">
                <i class="fa fa-cube"></i>
                <div>
                  <span class="label">{{ '::MyTrips:Goods' | abpLocalization }}</span>
                  <span class="value">{{ trip.goodsType }}</span>
                </div>
              </div>
            }
          </div>

          <div class="trip-actions">
            <a [routerLink]="['/trip', trip.id]" class="btn-view">
              <i class="fa fa-eye"></i> {{ '::TripList:ViewDetails' | abpLocalization }}
            </a>
          </div>
        </div>
      }
    </div>
  }
</div>
